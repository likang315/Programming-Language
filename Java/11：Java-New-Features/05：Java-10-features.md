### Java 10 新特性

------

[TOC]

##### 01：概述

- 在 2018 年 3 月 21 日发布，其中最备受广大开发者关注的莫过于**局部变量类型推断**。除此之外，还有其他包括垃圾收集器改善、GC 改进、性能提升、线程管控等一批新特性。

##### 02：局部变量类型推断

- 使用 `var` 关键字在声明局部变量时，编译器会自动推断其类型。

- var 关键字**只能用于声明局部变量，不能用于声明成员变量或方法参数**。另外，var声明的变量必须要有初始化值，否则编译器无法推断其类型。

- ```java
  var list = new ArrayList<String>(); // ArrayList<String>
  var stream = list.stream(); // Stream<String>
  ------
  著作权归@pdai所有
  原文链接：https://pdai.tech/md/java/java8up/java10.html
  ```

##### 03：应用程序类数据共享

- 在 Java 5 中就已经引入了类数据共享机制 (Class Data Sharing，简称 CDS)，允许将一组类（BootStrap类）预处理为共享归档文件，以便在运行时能够进行内存映射以减少 Java 程序的启动时间。
- Java 10 扩展加入了应用类的 CDS (Application Class-Data Sharing) 支持。
- 每个Java应用程序在**启动时都会加载大量的类**，这些类通常需要占用大量的内存和时间。ACDS机制将类数据缓存在一个或多个共享的归档文件（archive）中，这些**文件可以在多个Java进程之间共享**。当一个Java进程启动时，它会从这些归档文件中加载类的元数据信息，从而加速类加载过程。这种机制可以在多个Java应用程序之间共享，从而提高整个系统的性能。

##### 04：统一的垃圾回收接口

- Java 10 中，hotspot/gc 代码实现方面，引入一个通用的、干净的 GC 接口，改进不同 GC 源代码的隔离性，多个 GC 之间共享的实现细节代码应该存在于辅助类中。
- 即：java.lang.ref.Cleaner 类。
  - Cleaner：主要作用是替代了之前使用finalize()方法进行资源清理的方式。使用Cleaner类，开发人员可以更加灵活地管理资源清理操作，避免了finalize()方法的一些缺点。

##### 05：并行全垃圾回收器 G1

- Java 10 之前的版本中的 G1 垃圾回收器执行 GC 时采用的是**基于单线程标记扫描压缩算法**（mark-sweep-compact），Java 10 中将采用**并行化 mark-sweep-compact 算法**，并使用与年轻代回收和混合回收相同数量的线程，从而减少了 Full GC 的发生，以带来更好的性能提升、更大的吞吐量。
- 具体并行 GC 线程数量可以通过： **`-XX：ParallelGCThreads`** 参数来调节，但这也会影响用于年轻代和混合收集的工作线程数。

##### 06：线程-局部管控

- 在已有的 Java 版本中，JVM 线程只能全部启用或者停止，没法做到对单独某个线程的操作。为了能够对单独的某个线程进行操作，Java 10 中线程管控引入 JVM 安全点的概念，**将允许在不运行全局 JVM 安全点的情况下实现线程回调，由线程本身或者 JVM 线程来执行，同时保持线程处于阻塞状态**，这种方式使得停止单个线程变成可能，而不是只能启用或停止所有线程。通过这种方式显著地提高了现有 JVM 功能的性能开销，并且改变了到达 JVM 全局安全点的现有时间语义。
- 增加的参数为：`-XX:ThreadLocalHandshakes` (默认为开启)，将允许用户在支持的平台上选择安全点。

##### 07：额外的 Unicode 语言标签扩展

- Java 10 中将继续增加 Unicode 语言标签扩展，具体为：增强 java.util.Locale 类及其相关的 API，以更方便的获得所需要的语言地域环境信息。

##### 08：备用存储装置上的堆分配

- 使得 JVM 能够使用适用于不同类型的存储机制的堆，在可选内存设备上进行堆内存分配。
- 用堆分配参数 `**-XX：AllocateHeapAt = <path>**` ，这个参数将指向文件系统的文件并**使用内存映射来达到在备用存储设备上进行堆分配**的预期结果。

##### 09：根证书认证

- 从 Java 10 开始，将会在 JDK 中提供一套默认的 CA 根证书。
- 作为 JDK 一部分的 cacerts 密钥库旨在**包含一组能够用于在各种安全协议的证书链中建立信任的根证书**。

##### 10：基于时间的版本发布模式

- 命名机制

  - ```shell
    $FEATURE.$INTERIM.$UPDATE.$PATCH
    ```

  - **$FEATURE**：每次版本发布加 1，不考虑具体的版本内容。2018 年 3 月的版本是 JDK 10，10 月的版本是 JDK 11，依此类推。

  - **$INTERIM**：中间版本号，在大版本中间发布的，包含**问题修复和增强的版本**，不会引入非兼容性修改。









