### HttpClient

------

[TOC]

##### 01：概述 

- 执行HTTP方法，只要用户提供一个request的对象，HttpClient就会将用户的请求发送到目标服务器上，并且返回一个respone对象，如果没有执行成功将抛出一个异常；

##### 02：导入jar包

```xml
<dependency>
    <groupId>org.apache.httpcomponents</groupId>
    <artifactId>httpclient</artifactId>
    <version>4.5.6</version>
</dependency>
```

##### 03：GET、POST

```java
// GET request
public static NameValuePair sendGet(String url,
                                    List<NameValuePair> params,
                                    int timeout) {
    CloseableHttpClient httpclient = HttpClients.createDefault();
    HttpGet httpget = new HttpGet(url);
    RequestConfig config = RequestConfig.custom().setSocketTimeout(timeout).build();
    httpGet.setConfig(config);
    HttpResponse response;
    HttpEntity entity;
    int httpStatusCode = -1；
    String body;
    try {
        // 封装参数:?key=value&key1=value1
        if (Objects.nonNull(params) && params.size() > 0) {
            String str = EntityUtils.toString(new UrlEncodedFormEntity(
                params, Charsets.UTF_8));
            httpget.setURI(new URI(httpget.getURI().toString() + "?" + str));
        }
        // 发送请求
        response = httpclient.execute(httpget);
        // 获取状态码
        StatusLine sl = response.getStatusLine();
        if (sl != null) {
            httpStatusCode = sl.getStatusCode();
        }
        HttpEntity entity = response.getEntity();
        if (entity != null) {
            body = EntityUtils.toString(entity, "utf8");
        }
    } catch (SocketTimeoutException ex) {
        body = "-1";
        log.error("timeout...")
    } catch (Exception e) {
        body = "-1";
        log.error("sendGet.exception: {}", e)
    } finally {
        // 关闭请求附带的系统资源
        response.close();
    }

    return new BasicNameValuePair(String.valueOf(httpStatusCode), body);
}

// post request
public static NameValuePair sendPost(String url,
                                     List<NameValuePair> params,
                                     int timeout) {
    CloseableHttpClient httpclient = HttpClients.createDefault();
    HttpPost httppost = new HttpPost(url);
    RequestConfig config = RequestConfig.custom().setSocketTimeout(timeout).build();
    httpGet.setConfig(config);
    HttpResponse response;
    HttpEntity entity;
    int httpStatusCode = -1；
        String body;

    try {
        // 设置参数
        if (Objects.nonNull(params) && params.size() > 0) {
            httpPost.setEntity(new UrlEncodedFormEntity(params, Charsets.UTF_8));
        }
        response = httpclient.execute(httppost);
        // 获取状态码
        StatusLine sl = response.getStatusLine();
        if (sl != null) {
            httpStatusCode = sl.getStatusCode();
        }
        HttpEntity entity = response.getEntity();
        if (entity != null) {
            body = EntityUtils.toString(entity, "utf8");
        }
    } catch (SocketTimeoutException ex) {
        body = "-1";
        log.error("timeout...")
    } catch (Exception e) {
        body = "-1";
        log.error("sendGet.exception: {}", e)
    } finally {
        // 关闭请求附带的系统资源
        response.close();
    }

    return new BasicNameValuePair(String.valueOf(httpStatusCode), body);
}
```

##### 04：API

- HttpClient【Interface】
  - 提供执行HTTP请求的方法execute；
- CloseableHttpClient 【abstract class】
- HttpClient 的关键实现类
- **RequestConfig** 
  - 用于设置HTTP请求的一些参数，其内部类实现了配置了一些属性；
  - **RequestConfig config = RequestConfig.custom().setSocketTimeout(timeout).build();**
- HttpRequestBase【abstract class】
  - 实现了HttpUriRequest 类，定义了HTTP请求的一些基本方法，如：URI、RequestConfig等；
- **HttpGet**【extends HttpRequestBase】
  - 定义了HTTP请求URI和Method；
- **HttpPost** 【extends HttpEntityEnclosingRequestBase 】
  - 定义了HTTP请求URI和Method；
  - HttpEntityEnclosingRequestBase【extends HttpRequestBase】
    - 定义了HttpEntity 报体；
- **HttpResponse** 【extends HttpMessage】
  - StatusLine getStatusLine();
    - 获取状态码
  - HttpEntity getEntity();
    - 获取响应体;
- HttpStatus
  - HTTP 协议的所有状态码；
- MediaType
  - APPLICATION_JSON_VALUE;
    - 以Json字符串的方式传递参数；
  - APPLICATION_FORM_URLENCODED_VALUE;
    - 以key-value的方式传递参数；

